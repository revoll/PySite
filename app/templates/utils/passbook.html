{% extends "common/common_base.html" %}


{% block title %}密码本{% endblock %}


{% block styles %}
    {{ super() }}
    <style type="text/css">
        .table {
            width: 968px;
            table-layout: fixed;
            word-wrap: break-word;
            word-break: break-all;
        }
        .record-name {
            width: 22%;
            text-align: left;
        }
        .record-host {
            width: 20%;
            text-align: left;
        }
        .record-username {
            width: 12%;
            text-align: center;
            font-weight: bold;
        }
        .record-password {
            width: 12%;
            text-align: center;
        }
        .record-comments {
            width: 26%;
            text-align: left;
        }
        .widget-box {
            width: 8%;
            text-align: center;
        }
        .widget-box > .glyphicon {
            margin: 1px 4px;
            cursor: pointer;
        }

        .pointer {
            cursor: pointer;
        }
        .password-mask {
            position: relative;
        }
        .password-mask:before {
            position: absolute;
            left: 0;
            top: 8px;
            z-index: 1;
            width: 100%;
            height: 23px;
            font: italic bold 8px/24px arial,sans-serif;
            text-align: center;
            color: #666;
            background-color: #aaa;
            content: ' ';
        }
    </style>
{% endblock %}


{% block common_main %}
    <div>
        <a href="javascript:add_record()" class="docs-page-tool pull-right"><span class="glyphicon glyphicon-plus text-muted"></span></a>
    </div>

    <h1 class="docs-page-title docs-text-common">密码本</h1>

    <div class="table-responsive">
        <table class="table table-bordered table-striped table-hover">
            <thead>
                <tr>
                    <th class="record-name">记录名称（关键字）</th>
                    <th class="record-host">域名</th>
                    <th class="record-username">用户名</th>
                    <th class="record-password">密码</th>
                    <th class="record-comments">其它信息</th>
                    <th class="widget-box">操作</th>
                </tr>
            </thead>
            <tbody>{% for record in records %}
                <tr id="record-{{ record.id }}" data-id="{{ record.id }}" data-name="{{ record.name }}" data-keyword="{{ record.keyword }}">
                    <th class="record-name docs-text-common pointer" onclick="display_record({{ record.id }})">{{ record.name }}{% if record.keyword %}({{ record.keyword }}){% endif %}</th>
                    <td class="record-host">{{ record.host }}</td>
                    <td class="record-username">{{ record.username }}</td>
                    <td class="record-password pointer password-mask" onclick="$(this).toggleClass('password-mask');">{{ record.password }}</td>
                    <td class="record-comments">{{ record.comments }}</td>
                    <td class="widget-box">
                        <span class="glyphicon glyphicon-edit docs-text-common" onclick="edit_record({{ record.id }})"></span>
                        <span class="glyphicon glyphicon-remove docs-text-common" onclick="delete_record({{ record.id }})"></span>
                    </td>
                </tr>{% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}


{% block scripts %}
    {{ super() }}
    <!-- <script type="text/javascript" src="{{ url_for('static', filename='js/clipboard.min.js') }}"></script> -->
    <script type="text/javascript">
        var form_html = '<form id="record-form" class="form-horizontal" method="POST" action="">\
    {{ form.hidden_tag() }}\
    <input type="text" class="hidden" id="record-id" name="id" value="">\
    <div class="form-group">\
        <label for="record-name" class="col-sm-3 control-label">*记录名称</label>\
        <div class="col-sm-6">\
            <input type="text" class="form-control" id="record-name" name="name" placeholder="网址名称">\
        </div>\
    </div>\
    <div class="form-group">\
        <label for="record-keyword" class="col-sm-3 control-label">关键字</label>\
        <div class="col-sm-3">\
            <input type="text" class="form-control text-uppercase" id="record-keyword" name="keyword" placeholder="(可选)">\
        </div>\
    </div>\
    <div class="form-group">\
        <label for="record-host" class="col-sm-3 control-label">主机地址</label>\
        <div class="col-sm-6">\
            <input type="text" class="form-control" id="record-host" name="host" value="http://">\
        </div>\
    </div>\
    <div class="form-group">\
        <label for="record-username" class="col-sm-3 control-label">用户名</label>\
        <div class="col-sm-4">\
            <input type="text" class="form-control" id="record-username" name="username" placeholder="用户名">\
        </div>\
    </div>\
    <div class="form-group">\
        <label for="record-password" class="col-sm-3 control-label">密码</label>\
        <div class="col-sm-7">\
            <input type="text" class="form-control" id="record-password" name="password" placeholder="密码">\
        </div>\
    </div>\
    <div class="form-group">\
        <label for="record-comments" class="col-sm-3 control-label">其它信息</label>\
        <div class="col-sm-8">\
            <textarea rows="4" class="form-control" id="record-comments" name="comments" placeholder="输入备注内容..."/>\
        </div>\
    </div>\
    <div class="form-group">\
        <div class="col-sm-offset-3 col-sm-9">\
            <button type="submit" class="btn btn-primary">提交</button>\
        </div>\
    </div></form>';
        function add_record() {
            notification_init('新建记录', form_html, '');
            $('#record-form').attr('action', '{{ url_for(".passbook_create_record") }}');
            notification_show();
        }
        function edit_record(id) {
            notification_init('修改记录', form_html, '');
            $('#record-form').attr('action', '{{ url_for(".passbook_update_record", record_id=0) }}'.replace(/0/, id));
            var id_str = '#record-' + id;
            $('#record-id').val($(id_str).attr('data-id'));
            $('#record-keyword').val($(id_str).attr('data-keyword'));
            $('#record-name').val($(id_str).attr('data-name'));
            var children = $(id_str + ' td');
            $('#record-host').val(children.eq(0).text());
            $('#record-username').val(children.eq(1).text());
            $('#record-password').val(children.eq(2).text());
            $('#record-comments').val(children.eq(3).text());
            $('#record-btn-delete').toggleClass('hidden');
            notification_show();
        }
        function delete_record(id) {
            var footer_html = '<button type="button" class="btn btn-default" data-dismiss="modal">取消</button><a href="{{ url_for('.passbook_delete_record', record_id=0) }}" class="btn btn-danger">删除</a>';
            notification_init('删除记录', '确定删除此条记录？', footer_html.replace(/0/, id));
            notification_show();
        }
        function display_record(id) {
            var id_str = '#record-' + id;
            var children = $(id_str + ' td');
            var header_html = $(id_str).attr('data-name') + ($(id_str).attr('data-keyword') == '' ? '' : ('（' + $(id_str).attr('data-keyword') + '）'));
            var body_html = '<div class="form-horizontal">\
    <div class="form-group">\
        <label class="col-sm-2 control-label">域名</label>\
        <div class="col-sm-8">\
            <input type="text" class="form-control" value="' + children.eq(0).text() + '" readonly></input>\
        </div>\
    </div>\
    <div class="form-group">\
        <label class="col-sm-2 control-label">用户名</label>\
        <div class="col-sm-6">\
            <input type="text" class="form-control" value="' + children.eq(1).text() + '" readonly></input>\
        </div>\
    </div>\
    <div class="form-group">\
        <label class="col-sm-2 control-label">密码</label>\
        <div class="col-sm-6">\
            <input type="text" class="form-control" value="' + children.eq(2).text() + '" readonly></input>\
        </div>\
    </div>\
    <div class="form-group">\
        <label class="col-sm-2 control-label">备注信息</label>\
        <div class="col-sm-9">\
            <textarea class="form-control" rows="8" readonly>' + children.eq(3).text() + '</textarea>\
        </div>\
    </div></div>';
            notification_init(header_html, body_html, null);
            notification_show();
        }
    </script>
{% endblock %}
